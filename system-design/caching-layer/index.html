<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Caching Strategies System Design | Cache-Aside, Write-Through, Eviction Policies</title>
  <meta name="description"
    content="Master caching patterns: Cache-Aside vs Write-Through, Eviction policies (LRU/LFU), and how to solve the Thundering Herd problem with Redis examples.">
  <meta name="keywords"
    content="system design, caching, redis, cache-aside, write-through, write-back, lru, eviction policies, thundering herd">
  <meta name="author" content="Brijesh Patel">
  <link rel="canonical" href="https://brijesh.work/system-design/caching-layer/" />

  <!-- Styles -->
  <link rel="stylesheet" href="https://brijesh.work/pub/css/bootstrap.css">
  <link rel="stylesheet" href="https://brijesh.work/pub/css/style-main.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://brijesh.work/pub/js/global.js" crossorigin="anonymous"></script>

  <style>
    /* Shared System Design Theme */
    .hero-section {
      background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
      color: white;
      padding: 4rem 0;
      margin-bottom: 2rem;
    }

    .hero-subtitle {
      color: #cbd5e1;
      font-size: 1.25rem;
    }

    .sidebar-sticky {
      position: sticky;
      top: 2rem;
    }

    .sidebar-toc .nav-link {
      color: #64748b;
      padding: 0.25rem 0;
      font-size: 0.95rem;
    }

    .sidebar-toc .nav-link:hover,
    .sidebar-toc .nav-link.active {
      color: #0d6efd;
      font-weight: 500;
    }

    .content-section {
      margin-bottom: 3rem;
    }

    .tech-card {
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      height: 100%;
      background: #f8fafc;
      transition: transform 0.2s;
    }

    .tech-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .comparison-table th {
      background-color: #f1f5f9;
    }

    .badge-soft {
      background-color: rgba(13, 110, 253, 0.1);
      color: #0d6efd;
      padding: 0.5em 0.8em;
    }
  </style>
</head>

<body class="bg-white">

  <header loadhtml="https://brijesh.work/pub/inc/header.html" class="header border-bottom"></header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <span
            class="badge badge-soft mb-3 rounded-pill bg-warning bg-opacity-25 text-white border border-white border-opacity-25">Performance</span>
          <h1 class="display-4 fw-bold mb-3">Caching Strategies & Architecture</h1>
          <p class="hero-subtitle mb-4">The difference between a sluggish application and a lightning-fast experience
            lies in how effectively you cache data.</p>
          <div class="d-flex gap-3">
            <a href="#implementation" class="btn btn-warning text-dark fw-bold">View Implementation</a>
            <a href="#patterns" class="btn btn-outline-light">Compare Patterns</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container pb-5">
    <div class="row">

      <!-- Main Content (Ordered 2nd on Desktop, 1st on Mobile) -->
      <main class="col-lg-9 order-lg-2">

        <!-- Intro -->
        <section id="why-cache" class="content-section">
          <h2>Why Cache?</h2>
          <p class="lead text-secondary">Caching trades memory usage for reduced latency and lower database load.</p>
          <p>In a distributed system, fetching data from a database is slow (disk I/O, network). Fetching from a cache
            (memory) is orders of magnitude faster. A proper caching layer protects your database from being overwhelmed
            by read traffic.</p>

          <div class="row mt-4">
            <div class="col-md-6">
              <div class="tech-card">
                <h5 class="fw-bold mb-3">üöÄ Key Benefits</h5>
                <ul class="list-unstyled mb-0">
                  <li class="mb-2">‚úì <strong>Latency:</strong> ~1ms (Redis) vs ~100ms (Database).</li>
                  <li class="mb-2">‚úì <strong>Throughput:</strong> Serve 100k+ req/sec from memory.</li>
                  <li class="mb-2">‚úì <strong>Cost:</strong> Reduce DB provisioned IOPS.</li>
                </ul>
              </div>
            </div>
            <div class="col-md-6">
              <div class="tech-card">
                <h5 class="fw-bold mb-3">üìç Cache Locations</h5>
                <ul class="mb-0 small mt-2">
                  <li><strong>Browser/Client:</strong> HTTP Cache (Images, CSS).</li>
                  <li><strong>CDN (Edge):</strong> Geographic caching of static assets.</li>
                  <li><strong>Application:</strong> Local server memory (heap).</li>
                  <li><strong>Distributed:</strong> Shared Redis/Memcached cluster.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- Patterns -->
        <section id="patterns" class="content-section">
          <h2>Caching Patterns</h2>
          <p>How do we load data into the cache? Choosing the right pattern is critical for consistency.</p>

          <div id="cache-aside" class="mb-5 pt-3">
            <h4>1. Cache-Aside (Lazy Loading)</h4>
            <p>The application is responsible for reading and writing from the cache.</p>
            <ol>
              <li>App requests data from Cache.</li>
              <li><strong>Miss?</strong> App reads from Database.</li>
              <li>App writes data to Cache.</li>
              <li>App returns data.</li>
            </ol>
            <div class="alert alert-light border">
              <strong>Pros:</strong> Resilient to cache failure. Only requested data is cached.<br>
              <strong>Cons:</strong> Initial latency (3 trips). Data can become stale.
            </div>
          </div>

          <div id="write-through" class="mb-5 pt-3">
            <h4>2. Write-Through</h4>
            <p>The application writes to the Cache, and the Cache writes to the Database synchronously.</p>
            <div class="alert alert-light border">
              <strong>Pros:</strong> Data in cache is never stale.<br>
              <strong>Cons:</strong> Higher write latency (two writes). Cold cache on startup (needs cache warming).
            </div>
          </div>

          <div id="write-back" class="mb-4 pt-3">
            <h4>3. Write-Back (Write-Behind)</h4>
            <p>App writes only to Cache (fast). Cache asynchronously writes to Database later.</p>
            <div class="alert alert-warning border border-warning">
              <strong>Risk:</strong> If Cache crashes before syncing, <strong>DATA IS LOST</strong>. Use only for
              non-critical data (e.g., likes counts, analytics).
            </div>
          </div>
        </section>

        <!-- Eviction -->
        <section id="eviction" class="content-section">
          <h2>Eviction Policies</h2>
          <p>Cache memory is expensive and finite. When full, what do we delete?</p>

          <table class="table table-bordered comparison-table mt-3">
            <thead>
              <tr>
                <th>Policy</th>
                <th>Description</th>
                <th>Use Case</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>LRU (Least Recently Used)</strong></td>
                <td>Removes items that haven't been used for the longest time.</td>
                <td>Most common. Good for social media (recent news is hot).</td>
              </tr>
              <tr>
                <td><strong>LFU (Least Frequently Used)</strong></td>
                <td>Removes items with the fewest hits.</td>
                <td>Good for general content that doesn't change often.</td>
              </tr>
              <tr>
                <td><strong>FIFO (First In First Out)</strong></td>
                <td>Removes the oldest item inserted.</td>
                <td>Simple, but poor performance (evicts hot old data).</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Problems -->
        <section id="problems" class="content-section">
          <h2>Common Pitfalls</h2>

          <h5 class="fw-bold mt-4">üõë Thundering Herd (Cache Stampede)</h5>
          <p>When a popular cache key expires, thousands of concurrent requests might get a "MISS" and ALL try to query
            the database simultaneously, crashing it.</p>
          <p><strong>Solution:</strong>
          <ul>
            <li><strong>Mutex Lock:</strong> Only let 1 request query the DB; others wait.</li>
            <li><strong>Probabilistic Early Expiration:</strong> Refresh the key slightly <em>before</em> it actually
              expires.</li>
          </ul>
          </p>

          <h5 class="fw-bold mt-4">‚ùÑÔ∏è Cache Avalanche</h5>
          <p>When many keys expire at the exact same time (e.g., rigid TTLs).</p>
          <p><strong>Solution:</strong> Add "Jitter" (randomness) to TTLs. E.g., `TTL = 300s + rand(0-60s)`.</p>
        </section>

        <!-- Implementation -->
        <section id="implementation" class="content-section">
          <h2>Python Implementation: Cache-Aside with Redis</h2>
          <p>A production-ready example using `redis-py` covering the "Check -> DB -> Set" logic with TTL.</p>

          <pre><code class="language-python">import redis
import json
import time

# Connect to Redis
r = redis.Redis(host='localhost', port=6379, decode_responses=True)

def get_user_profile(user_id):
    cache_key = f"user:{user_id}"
    
    # 1. Try Cache
    cached_data = r.get(cache_key)
    if cached_data:
        print("Cache HIT")
        return json.loads(cached_data)
    
    # 2. Cache MISS - Fetch User from DB (Simulated)
    print("Cache MISS - Reading DB...")
    # db_data = db.query("SELECT * FROM users WHERE id = ?", user_id)
    time.sleep(0.1) # Simulate DB latency
    db_data = {"id": user_id, "name": "Brijesh", "role": "Architect"}
    
    # 3. Write to Cache with TTL (Time To Live)
    # Expiry 60s to prevent stale data forever
    r.setex(cache_key, 60, json.dumps(db_data))
    
    return db_data

# Simulation
get_user_profile(101) # Miss -> DB -> Cache
get_user_profile(101) # Hit -> Cache
</code></pre>
        </section>

        <section class="content-section border-top pt-5">
          <h2>Summary</h2>
          <ul>
            <li>Use **Cache-Aside** for general read-heavy apps.</li>
            <li>Use **LRU** eviction for most use cases.</li>
            <li>Always set a **TTL** (Time To Live) to expire data.</li>
            <li>Add **Jitter** to TTLs to prevent Avalanches.</li>
          </ul>
        </section>

      </main>

      <!-- Sidebar (Ordered 1st on Desktop, 2nd on Mobile) -->
      <aside class="col-lg-3 order-lg-1 mb-4">
        <div class="sidebar-sticky">
          <h6 class="fw-bold text-uppercase text-secondary mb-3 small tracking-wide">On this page</h6>
          <nav class="nav flex-column sidebar-toc">
            <a class="nav-link" href="#why-cache">Why Cache?</a>
            <a class="nav-link" href="#patterns">Caching Patterns</a>
            <a class="nav-link ms-3" href="#cache-aside">‚Ä¢ Cache-Aside</a>
            <a class="nav-link ms-3" href="#write-through">‚Ä¢ Write-Through</a>
            <a class="nav-link ms-3" href="#write-back">‚Ä¢ Write-Back</a>
            <a class="nav-link" href="#eviction">Eviction Policies (LRU)</a>
            <a class="nav-link" href="#problems">Common Pitfalls</a>
            <a class="nav-link ms-3" href="#problems">‚Ä¢ Thundering Herd</a>
            <a class="nav-link ms-3" href="#problems">‚Ä¢ Avalanche</a>
            <a class="nav-link" href="#implementation">Python Implementation</a>
          </nav>

          <hr class="my-4">
          <h6 class="fw-bold text-secondary mb-3 small">Related Topics</h6>
          <ul class="list-unstyled small">
            <li class="mb-2"><a href="../load-balancing/" class="text-decoration-none text-muted">Load Balancing</a>
            </li>
            <li class="mb-2"><a href="../rate-limiting/" class="text-decoration-none text-muted">Rate Limiting</a></li>
            <li class="mb-2"><a href="../consistent-hashing/" class="text-decoration-none text-muted">Consistent
                Hashing</a></li>
          </ul>
        </div>
      </aside>

    </div>
  </div>

  <footer loadhtml="https://brijesh.work/pub/inc/footer.html"></footer>
  <script src="https://brijesh.work/pub/js/footer.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script>includeHTML();</script>
</body>

</html>