<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Designing a Secure API Gateway for Microservices — System Design | Brijesh Patel</title>
<meta name="description" content="Tutorial: designing a secure API gateway—authentication, authorization, rate-limiting, and mTLS for microservices.">
<link rel="canonical" href="https://brijesh.work/system-design/secure-api-gateway/" />
<link rel="stylesheet" href="https://brijesh.work/pub/css/bootstrap.css">
<link rel="stylesheet" href="https://brijesh.work/pub/css/style-main.css">
<script src="https://brijesh.work/pub/js/global.js" crossorigin="anonymous"></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Designing a Secure API Gateway for Microservices",
  "description": "Patterns for securing API gateways: auth, authorization, rate limiting, and mutual TLS.",
  "author": {
    "@type": "Person",
    "name": "Brijesh Patel"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://brijesh.work/system-design/secure-api-gateway/"
  },
  "url": "https://brijesh.work/system-design/secure-api-gateway/"
}
</script>
</head>
<body>
<header loadhtml="https://brijesh.work/pub/inc/header.html" class="header"></header>

<section>
  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-8">
        <h1>Designing a Secure API Gateway for Microservices</h1>
        <p class="lead">Patterns for securing API gateways: auth, authorization, token validation, rate limiting and mutual TLS.</p>

        <h2 id="threat-model">Threat model</h2>
        <p>Consider unauthorized access, API abuse, injection, and lateral movement. Gateways enforce perimeter checks and reduce risks for downstream services.</p>

        <h3 id="features">Important features</h3>
        <ul>
          <li>Authentication (JWT, OAuth2) and token validation</li>
          <li>Authorization (ACLs, RBAC integration)</li>
          <li>Rate limiting and circuit breakers</li>
          <li>mTLS for service-to-service communication</li>
        </ul>

        <h2 id="architecture">Architecture diagram</h2>
        <figure>
          <svg width="100%" height="220" viewBox="0 0 800 220" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="API Gateway architecture">
            <rect x="20" y="20" width="160" height="60" fill="#f8f9fa" stroke="#6c757d"/>
            <text x="100" y="55" font-size="13" text-anchor="middle" fill="#343a40">Client</text>
            <rect x="220" y="10" width="200" height="80" fill="#e9ecef" stroke="#6c757d"/>
            <text x="320" y="55" font-size="13" text-anchor="middle" fill="#343a40">API Gateway (auth, rate-limit, TLS)</text>
            <rect x="460" y="10" width="120" height="60" fill="#fff3cd" stroke="#6c757d"/>
            <text x="520" y="45" font-size="13" text-anchor="middle" fill="#343a40">Auth Service</text>
            <rect x="220" y="110" width="120" height="60" fill="#d4edda" stroke="#6c757d"/>
            <text x="280" y="145" font-size="13" text-anchor="middle" fill="#343a40">Service A</text>
            <rect x="360" y="110" width="120" height="60" fill="#d4edda" stroke="#6c757d"/>
            <text x="420" y="145" font-size="13" text-anchor="middle" fill="#343a40">Service B</text>
            <line x1="180" y1="50" x2="220" y2="50" stroke="#6c757d" marker-end="url(#arrow)"/>
            <line x1="420" y1="50" x2="460" y2="50" stroke="#6c757d" marker-end="url(#arrow)"/>
            <line x1="320" y1="90" x2="320" y2="110" stroke="#6c757d" marker-end="url(#arrow)"/>
            <line x1="280" y1="110" x2="280" y2="110" stroke="transparent"/>
            <defs>
              <marker id="arrow" markerWidth="10" markerHeight="10" refX="6" refY="3" orient="auto">
                <path d="M0,0 L0,6 L6,3 z" fill="#6c757d" />
              </marker>
            </defs>
          </svg>
          <figcaption>Client traffic passes through the API Gateway where auth, rate limiting, and TLS termination happen before requests reach backend services.</figcaption>
        </figure>

        <h2 id="examples">Patterns & examples</h2>
        <h3 id="jwt-validation">JWT validation (Node/Express)</h3>
        <pre><code class="language-javascript">const jwt = require('jsonwebtoken');
module.exports = function (req, res, next) {
  const token = req.headers.authorization && req.headers.authorization.split(' ')[1];
  if (!token) return res.status(401).send('Missing token');
  try {
    const payload = jwt.verify(token, process.env.JWT_PUBLIC_KEY, { algorithms: ['RS256'] });
    req.user = payload;
    next();
  } catch (err) {
    return res.status(401).send('Invalid token');
  }
};</code></pre>

        <h3 id="envoy">Envoy (JWT + route example)</h3>
        <pre><code class="language-yaml">static_resources:
  listeners:
  - name: listener_http
    address:
      socket_address: { address: 0.0.0.0, port_value: 8080 }
    filter_chains:
    - filters:
      - name: envoy.filters.network.http_connection_manager
        typed_config:
          "@type": type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager
          stat_prefix: ingress_http
          route_config:
            virtual_hosts:
            - name: backend
              domains: ["*"]
              routes:
              - match: { prefix: "/api/" }
                route: { cluster: "backend" }</code></pre>

        <h3 id="istio">Istio VirtualService (canary routing)</h3>
        <pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: myservice
spec:
  hosts:
  - myservice.default.svc.cluster.local
  http:
  - route:
    - destination:
        host: myservice
        subset: v1
      weight: 90
    - destination:
        host: myservice
        subset: v2
      weight: 10</code></pre>

        <h3 id="rate-limiting">Rate limiting (Redis + Lua token bucket)</h3>
        <pre><code class="language-lua">-- KEYS[1] = bucket key, ARGV[1]=capacity, ARGV[2]=tokens, ARGV[3]=refill_per_sec
local capacity = tonumber(ARGV[1])
local tokens = tonumber(ARGV[2])
local refill = tonumber(ARGV[3])
local now = redis.call('TIME')
local last = tonumber(redis.call('HGET', KEYS[1], 'ts') or 0)
local stored = tonumber(redis.call('HGET', KEYS[1], 'tokens') or capacity)
local delta = (now[1] - last) * 1 + (now[2] - 0) / 1000000
stored = math.min(capacity, stored + delta * refill)
if stored < tokens then
  return 0
else
  stored = stored - tokens
  redis.call('HSET', KEYS[1], 'tokens', stored, 'ts', now[1])
  return 1
end</code></pre>

        <h3 id="mtls">mTLS (dev/test quick-start)</h3>
        <pre><code class="language-bash"># generate CA
openssl genrsa -out ca.key 2048
openssl req -x509 -new -nodes -key ca.key -subj "/CN=local-ca" -days 3650 -out ca.crt
# server cert
openssl genrsa -out server.key 2048
openssl req -new -key server.key -subj "/CN=api-gateway.local" -out server.csr
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 365</code></pre>

        <h3 id="observability">Observability & ops</h3>
        <ul>
          <li>Emit structured access logs from the gateway (request id, auth subject, latency, status).</li>
          <li>Export metrics for requests, rejected-by-policy, rate-limit hits, and upstream latency.</li>
          <li>Correlate traces through W3C TraceContext or OpenTelemetry to trace requests across gateway and services.</li>
        </ul>

        <p>Related: <a href="https://brijesh.work/system-design/cicd-pipeline-design/">CI/CD pipelines</a>, <a href="https://brijesh.work/system-design/containerized-docker-kubernetes/">Docker & Kubernetes</a>, <a href="https://brijesh.work/system-design/monitoring-prometheus-grafana/">Monitoring</a>, <a href="https://brijesh.work/system-design/rbac/">RBAC patterns</a>.</p>

        <h2 id="conclusion">Conclusion</h2>
        <p>Design gateways to enforce security consistently and push complex policies out of individual services. Pair with observability to detect misuse early.</p>
      </div>

      <aside class="col-12 col-lg-4">
        <div class="card mb-4"><div class="card-body"><h5>Quick links</h5><ul class="list-unstyled"><li><a href="#threat-model">Threat model</a></li><li><a href="#features">Features</a></li></ul></div></div>
      </aside>
    </div>
  </div>
</section>

<footer loadhtml="https://brijesh.work/pub/inc/footer.html"></footer>
<script src="https://brijesh.work/pub/js/footer.js" crossorigin="anonymous"></script>
<script>includeHTML();</script>
</body>
</html>
