<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cloud Storage System Design | S3 Architecture, Erasure Coding & Consistency</title>
  <meta name="description"
    content="Deep dive into designing a scalable Cloud Object Storage (like AWS S3): Architecture, Data Partitioning, Erasure Coding vs Replication, Strong Consistency, and Multiplayer Uploads.">
  <meta name="keywords"
    content="system design, cloud storage, object storage, s3 architecture, erasure coding, consistent hashing, cap theorem, strong consistency, multipart upload">
  <meta name="author" content="Brijesh Patel">
  <link rel="canonical" href="https://brijesh.work/system-design/cloud-storage-system-design/" />

  <!-- Styles -->
  <link rel="stylesheet" href="https://brijesh.work/pub/css/bootstrap.css">
  <link rel="stylesheet" href="https://brijesh.work/pub/css/style-main.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://brijesh.work/pub/js/global.js" crossorigin="anonymous"></script>

  <style>
    /* Shared System Design Theme */
    .hero-section {
      background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
      color: white;
      padding: 4rem 0;
      margin-bottom: 2rem;
    }

    .hero-subtitle {
      color: #cffafe;
      font-size: 1.25rem;
    }

    .sidebar-sticky {
      position: sticky;
      top: 2rem;
    }

    .sidebar-toc .nav-link {
      color: #64748b;
      padding: 0.25rem 0;
      font-size: 0.95rem;
    }

    .sidebar-toc .nav-link:hover,
    .sidebar-toc .nav-link.active {
      color: #0e7490;
      font-weight: 500;
    }

    .content-section {
      margin-bottom: 3rem;
    }

    .tech-card {
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      height: 100%;
      background: #f8fafc;
      transition: transform 0.2s;
    }

    .tech-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .comparison-table th {
      background-color: #ecfeff;
    }

    .badge-soft {
      background-color: rgba(8, 145, 178, 0.1);
      color: #0891b2;
      padding: 0.5em 0.8em;
    }

    .arch-diagram {
      background: #ffffff;
      border: 2px dashed #a5f3fc;
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      margin-bottom: 1.5rem;
      font-family: monospace;
    }

    .arch-box {
      border: 2px solid #94a3b8;
      padding: 10px 20px;
      display: inline-block;
      margin: 10px;
      background: #fff;
      border-radius: 8px;
      font-weight: bold;
    }

    .arrow {
      font-size: 1.5rem;
      color: #06b6d4;
      vertical-align: middle;
      margin: 0 10px;
    }

    @media (max-width: 991px) {
      .order-lg-1 {
        order: 2;
      }

      .order-lg-2 {
        order: 1;
      }
    }
  </style>
</head>

<body class="bg-white">

  <header loadhtml="https://brijesh.work/pub/inc/header.html" class="header border-bottom"></header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <span
            class="badge badge-soft mb-3 rounded-pill bg-light bg-opacity-25 text-white border border-white border-opacity-25">Distributed
            Storage</span>
          <h1 class="display-4 fw-bold mb-3">Cloud Storage Design (S3)</h1>
          <p class="hero-subtitle mb-4">Architecting a planet-scale object store: Decoupling Metadata from Data, Erasure
            Coding for 99.999999999% durability, and Strong Consistency.</p>
          <div class="d-flex gap-3">
            <a href="#architecture" class="btn btn-light text-info fw-bold"
              style="color: #0e7490 !important;">Architecture</a>
            <a href="#erasure" class="btn btn-outline-light">Erasure Coding</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container pb-5">
    <div class="row">

      <!-- Main Content -->
      <main class="col-lg-9 order-lg-2">

        <!-- Architecture -->
        <section id="architecture" class="content-section">
          <h2>High-Level Architecture</h2>
          <p class="lead text-secondary">The core principle is separation of concerns: <strong>Metadata</strong> (the
            directory structure) is stored separately from <strong>Block Data</strong> (the actual file content).</p>

          <div class="arch-diagram d-none d-md-block">
            <div class="arch-box bg-dark text-white">Client</div>
            <span class="arrow">→</span>
            <div class="arch-box">Load Balancer</div>
            <span class="arrow">→</span>
            <div class="arch-box bg-primary text-white">API Service</div>
            <br>
            <span class="arrow" style="transform: rotate(90deg); display: inline-block;">⬇</span>
            &nbsp;&nbsp;&nbsp;&nbsp; <span class="arrow"
              style="transform: rotate(90deg); display: inline-block;">⬇</span>
            <br>
            <div class="arch-box bg-warning text-dark">Metadata Store<br><small>(DynamoDB/Cassandra)</small></div>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <div class="arch-box bg-success text-white">Block Store<br><small>(HDD/SSD Cluster)</small></div>
          </div>

          <h4 class="mt-4">Component Responsibilities</h4>
          <ul>
            <li><strong>API Service:</strong> Authentication (IAM), Rate Limiting, and Request Orchestration.</li>
            <li><strong>Metadata Store:</strong> Stores `Buckets`, `ObjectKeys`, `ACLs`. Needs fast Key-Value lookups.
            </li>
            <li><strong>Block Store:</strong> Stores immutable chunks of data (Blobs). Optimized for throughput (MB/s).
            </li>
          </ul>
        </section>

        <!-- Partitioning -->
        <section id="partitioning" class="content-section">
          <h2>Data Partitioning</h2>
          <p>You cannot store Petabytes on one machine. We rely on <strong>Consistent Hashing</strong> to distribute
            data across thousands of nodes.</p>

          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="tech-card">
                <h5 class="fw-bold">Namespace Partitioning</h5>
                <p class="small text-muted">Objects are distributed based on a hash of the
                  <code>BucketName + ObjectKey</code>. This prevents hot spots unless a single key gets massive traffic
                  (handled by caching).</p>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="tech-card">
                <h5 class="fw-bold">Consistent Hashing</h5>
                <p class="small text-muted">A virtual ring topology. When a node is added/removed, only <code>1/N</code>
                  keys need to be remapped, minimizing data shuffling.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Erasure Coding -->
        <section id="erasure" class="content-section">
          <h2>Erasure Coding vs Replication</h2>
          <p>How does S3 achieve 11 9s of durability without bankrupting AWS?</p>

          <table class="table table-bordered comparison-table">
            <thead>
              <tr>
                <th>Strategy</th>
                <th>Concept</th>
                <th>Storage Overhead</th>
                <th>Use Case</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>3x Replication</strong></td>
                <td>Stores 3 full copies of data.</td>
                <td><strong>200% Overhead</strong> (3GB for 1GB data)</td>
                <td>Fast Reads, Low Latency access (Hot Tier).</td>
              </tr>
              <tr>
                <td><strong>Erasure Coding (EC)</strong></td>
                <td>Splits data into `n` chunks + `k` parity.</td>
                <td><strong>~50% Overhead</strong> (1.5GB for 1GB data)</td>
                <td>High Durability, Cold/Warm Storage (S3 Standard).</td>
              </tr>
            </tbody>
          </table>

          <div class="alert alert-info border border-info mt-3">
            <strong>Example (4+2 Encoding):</strong> Split file into 4 data chunks + calculate 2 parity chunks. You can
            lose <strong>ANY 2</strong> chunks and still recover the file. Overhead is just 50%!
          </div>
        </section>

        <!-- Python Example -->
        <section id="code" class="content-section">
          <h2>Implementation: Multipart Upload (Python Boto3)</h2>
          <p>For large files (>100MB), passing a single stream is risky (network failure). Use <strong>Multipart
              Uploads</strong> to upload chunks in parallel.</p>

          <pre><code class="language-python">import boto3
from boto3.s3.transfer import TransferConfig

s3 = boto3.client('s3')
config = TransferConfig(
    multipart_threshold=1024 * 25, # 25MB threshold
    max_concurrency=10,
    multipart_chunksize=1024 * 25,
    use_threads=True
)

file_path = '/path/to/large_video.mp4'
key = 'uploads/video.mp4'
bucket = 'my-streaming-bucket'

def upload_file():
    # Boto3 handles the complex logic of:
    # 1. InitiateMultipartUpload
    # 2. UploadPart (in parallel threads)
    # 3. CompleteMultipartUpload
    s3.upload_file(file_path, bucket, key, Config=config)
    print("Upload Complete!")

# Presigned URL for Secure Direct-to-S3 Upload (Client-Side)
def generate_presigned_url():
    return s3.generate_presigned_url(
        'put_object',
        Params={'Bucket': bucket, 'Key': key},
        ExpiresIn=3600
    )</code></pre>
        </section>

        <!-- Consistency -->
        <section id="consistency" class="content-section">
          <h2>Consistency Models: Strong vs Eventual</h2>
          <p>Historically, S3 was <strong>Eventual Consistency</strong> (updates might take seconds to propogate). In
            2020, AWS moved to <strong>Strong Consistency</strong>.</p>
          <div class="tech-card">
            <h5 class="fw-bold">How Strong Consistency Works (Simplified)</h5>
            <p class="mb-0">When you write a new object, the request doesn't return <code>200 OK</code> until the data
              is safely replicated to a quorum of nodes. Subsequent <code>GET</code> requests are guaranteed to see the
              new object immediately.</p>
          </div>
        </section>

        <section class="content-section border-top pt-5">
          <h2>Summary</h2>
          <ul>
            <li><strong>Decouple Metadata:</strong> Separate the filename/index (DynamoDB) from the blob content (HDD).
            </li>
            <li><strong>Erasure Coding:</strong> Use EC for massive durability at low cost compared to replication.</li>
            <li><strong>Multipart Uploads:</strong> Essential for reliability and speed with large files.</li>
            <li><strong>Consistency:</strong> Modern object stores prioritize Strong Consistency for better DX.</li>
          </ul>
        </section>

      </main>

      <!-- Sidebar -->
      <aside class="col-lg-3 order-lg-1 mb-4">
        <div class="sidebar-sticky">
          <h6 class="fw-bold text-uppercase text-secondary mb-3 small tracking-wide">On this page</h6>
          <nav class="nav flex-column sidebar-toc">
            <a class="nav-link" href="#architecture">Architecture</a>
            <a class="nav-link" href="#partitioning">Data Partitioning</a>
            <a class="nav-link" href="#erasure">Erasure Coding</a>
            <a class="nav-link" href="#code">Python Example</a>
            <a class="nav-link" href="#consistency">Consistency Models</a>
          </nav>

          <hr class="my-4">
          <h6 class="fw-bold text-secondary mb-3 small">Related Topics</h6>
          <ul class="list-unstyled small">
            <li class="mb-2"><a href="../file-upload/" class="text-decoration-none text-muted">File Upload System</a>
            </li>
            <li class="mb-2"><a href="../fault-tolerant-patterns/" class="text-decoration-none text-muted">Fault
                Tolerance</a></li>
            <li class="mb-2"><a href="../structure-as-code-terraform/" class="text-decoration-none text-muted">Terraform
                (IaC)</a></li>
          </ul>
        </div>
      </aside>

    </div>
  </div>

  <footer loadhtml="https://brijesh.work/pub/inc/footer.html"></footer>
  <script src="https://brijesh.work/pub/js/footer.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script>includeHTML();</script>
</body>

</html>