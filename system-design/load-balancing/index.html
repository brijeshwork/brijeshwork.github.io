<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Load Balancing System Design Guide | Algorithms, L4 vs L7, Implementation</title>
  <meta name="description"
    content="In-depth guide to Load Balancing: Round Robin, Consistent Hashing, L4 vs L7, active-passive HA, and Python implementation examples.">
  <meta name="keywords"
    content="system design, load balancing, horizontal scaling, consistent hashing, l4 vs l7, round robin, least connections, high availability">
  <meta name="author" content="Brijesh Patel">
  <link rel="canonical" href="https://brijesh.work/system-design/load-balancing/" />

  <!-- Styles -->
  <link rel="stylesheet" href="https://brijesh.work/pub/css/bootstrap.css">
  <link rel="stylesheet" href="https://brijesh.work/pub/css/style-main.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://brijesh.work/pub/js/global.js" crossorigin="anonymous"></script>

  <style>
    /* Custom styles similar to Rate Limiting page */
    .hero-section {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: white;
      padding: 4rem 0;
      margin-bottom: 2rem;
    }

    .hero-subtitle {
      color: #94a3b8;
      font-size: 1.25rem;
    }

    .sidebar-sticky {
      position: sticky;
      top: 2rem;
    }

    .sidebar-toc .nav-link {
      color: #64748b;
      padding: 0.25rem 0;
      font-size: 0.95rem;
    }

    .sidebar-toc .nav-link:hover,
    .sidebar-toc .nav-link.active {
      color: #0d6efd;
      font-weight: 500;
    }

    .content-section {
      margin-bottom: 3rem;
    }

    .tech-card {
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      height: 100%;
      background: #f8fafc;
      transition: transform 0.2s;
    }

    .tech-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .comparison-table th {
      background-color: #f1f5f9;
    }

    .algo-visual {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      margin: 1.5rem 0;
    }

    .badge-soft {
      background-color: rgba(13, 110, 253, 0.1);
      color: #0d6efd;
      padding: 0.5em 0.8em;
    }
  </style>
</head>

<body class="bg-white">

  <header loadhtml="https://brijesh.work/pub/inc/header.html" class="header border-bottom"></header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <span
            class="badge badge-soft mb-3 rounded-pill bg-primary bg-opacity-25 text-white border border-white border-opacity-25">Core
            Concept</span>
          <h1 class="display-4 fw-bold mb-3">Load Balancing & Horizontal Scaling</h1>
          <p class="hero-subtitle mb-4">The critical component that distributes network traffic across multiple servers
            to ensure high availability, reliability, and scale.</p>
          <div class="d-flex gap-3">
            <a href="#implementation" class="btn btn-primary">View Implementation</a>
            <a href="#algorithms" class="btn btn-outline-light">Compare Algorithms</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container pb-5">
    <div class="row">

      <!-- Main Content -->
      <main class="col-lg-9 order-lg-2">

        <!-- Intro -->
        <section id="what-is-lb" class="content-section">
          <h2>What is Load Balancing?</h2>
          <p class="lead text-secondary">A load balancer acts as a "traffic cop" sitting in front of your backend
            servers.</p>
          <p>In modern high-traffic websites, serving millions of reliable requests typically requires adding more
            servers (horizontal scaling). A load balancer distributes incoming network traffic across a group of backend
            servers, ensuring no single server bears too much load. By spreading the work evenly, load balancing
            improves responsiveness and increases availability of applications.</p>

          <div class="row mt-4">
            <div class="col-md-6">
              <div class="tech-card">
                <h5 class="fw-bold mb-3">üõ°Ô∏è Key Benefits</h5>
                <ul class="list-unstyled mb-0">
                  <li class="mb-2">‚úì <strong>Availability:</strong> If a server dies, traffic is routed to healthy ones.
                  </li>
                  <li class="mb-2">‚úì <strong>Scalability:</strong> Add/remove servers on demand without downtime.</li>
                  <li class="mb-2">‚úì <strong>Security:</strong> Can defend against DDoS and hide backend IPs.</li>
                  <li>‚úì <strong>Performance:</strong> Routes to the fastest or closest resources.</li>
                </ul>
              </div>
            </div>
            <div class="col-md-6">
              <div class="tech-card">
                <h5 class="fw-bold mb-3">üìç Placement</h5>
                <p class="small text-muted mb-0">Load balancers sit at multiple layers:</p>
                <ul class="mb-0 small mt-2">
                  <li>Between User and Web Servers (NGINX, AWS ALB)</li>
                  <li>Between Web Servers and App Servers</li>
                  <li>Between App Servers and Reporting Database</li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- L4 vs L7 -->
        <section id="l4-vs-l7" class="content-section">
          <h2>L4 vs L7 Load Balancing</h2>
          <p>Load balancers are often categorized by the OSI layer at which they operate. The choice depends on
            performance needs vs. routing intelligence.</p>

          <div class="table-responsive mt-3">
            <table class="table table-bordered comparison-table">
              <thead>
                <tr>
                  <th style="width: 50%">Layer 4 (Transport Layer)</th>
                  <th style="width: 50%">Layer 7 (Application Layer)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>How it works:</strong> Routes based on IP range and Port (TCP/UDP). It doesn't look inside
                    the packet content.</td>
                  <td><strong>How it works:</strong> Routes based on content (HTTP Headers, URL, Cookies, Message Data).
                  </td>
                </tr>
                <tr>
                  <td><strong>Pros:</strong> Extremely fast, handles millions of connections, secure (no decryption
                    needed at LB).</td>
                  <td><strong>Pros:</strong> Smarter routing (e.g., `/video` to video servers), Sticky Sessions,
                    Authentication, TLS Termination.</td>
                </tr>
                <tr>
                  <td><strong>Cons:</strong> "Dumb" routing. Can't route based on request type or content.</td>
                  <td><strong>Cons:</strong> Slower (needs to buffer/inspect packets), requires decryption (CPU
                    intensive).</td>
                </tr>
                <tr>
                  <td><strong>Examples:</strong> AWS Network Load Balancer, HAProxy (TCP mode).</td>
                  <td><strong>Examples:</strong> NGINX, HAProxy (HTTP mode), AWS Application Load Balancer.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Algorithms -->
        <section id="algorithms" class="content-section">
          <h2>Load Balancing Algorithms</h2>
          <p>How does the load balancer choose which server to send a request to? Here are the standard strategies.</p>

          <div id="round-robin" class="mb-4 pt-3">
            <h4>1. Round Robin & Weighted Round Robin</h4>
            <p><strong>Round Robin:</strong> Requests are distributed sequentially. Server A -> Server B -> Server C ->
              Server A.</p>
            <p><strong>Weighted:</strong> If Server B is 2x more powerful than A, it gets 2x the traffic (Weights: A=1,
              B=2, C=1).</p>
            <div class="alert alert-light border">
              <strong>Use Case:</strong> Simple stateless services where all servers have roughly equivalent capacity.
            </div>
          </div>

          <div id="least-conn" class="mb-4 pt-3">
            <h4>2. Least Connections</h4>
            <p>Routes traffic to the server with the <strong>fewest active connections</strong>. This is useful when
              processing times vary significantly (e.g., chat servers or long-polling).</p>
          </div>

          <div id="consistent-hasing" class="mb-4 pt-3">
            <h4>3. Consistent Hashing</h4>
            <p>Crucial for distributed caching systems. Traditional hashing (`key % n_servers`) fails when servers are
              added/removed because nearly ALL keys get remapped, causing massive cache misses.</p>
            <p><strong>Consistent Hashing</strong> maps servers and keys to a "Ring". A key is routed to the next server
              clockwise on the ring. Adding/Removing a server only affects neighbors, minimizing reorganization.</p>
          </div>
        </section>

        <!-- Health Checks -->
        <section id="health-checks" class="content-section">
          <h2>Health Checks & High Availability</h2>
          <p>A load balancer must know if a backend is dead. This is done via <strong>Health Checks</strong>.</p>

          <ul>
            <li><strong>Active Checks:</strong> The LB pings the server (e.g., `GET /health`) every 5 seconds. If it
              fails 3 times, it's marked "Unhealthy".</li>
            <li><strong>Passive Checks:</strong> The LB observes real traffic. If multiple requests time out, the server
              is temporarily evaded.</li>
          </ul>

          <h4 id="ha-patterns" class="mt-4">HA Patterns for Load Balancers</h4>
          <p>What if the Load Balancer itself dies? You need redundancy.</p>
          <p><strong>Active-Passive:</strong> Two LBs run. One processes traffic, the other sits idle (heartbeating). If
            the main dies, the passive takes over the VIP (Virtual IP).</p>
        </section>

        <!-- Implementation -->
        <section id="implementation" class="content-section">
          <h2>Python Implementation: Weighted Round Robin</h2>
          <p>A tailored example of a thread-safe Weighted Round Robin implementation, similar to what NGINX or LVS might
            use internally.</p>

          <pre><code class="language-python">import itertools
import threading

class WeightedRoundRobin:
    def __init__(self, servers):
        """
        servers: dict like {'server_a': 5, 'server_b': 1, 'server_c': 1}
        Strength relates to weight.
        """
        self.servers = servers
        self.lock = threading.Lock()
        
        # Expand the list based on weight
        # Server A (5) will appear 5 times, B (1) once.
        self._pool = []
        for server, weight in servers.items():
            self._pool.extend([server] * weight)
            
        # Create an infinite iterator
        self._cycle = itertools.cycle(self._pool)

    def get_server(self):
        """Thread-safe method to get next server"""
        with self.lock:
            return next(self._cycle)

# Usage Simulation
lb = WeightedRoundRobin({
    'prod-api-01 (High CPU)': 3,
    'prod-api-02 (Low CPU)': 1, 
    'prod-api-03 (Low CPU)': 1
})

print("Traffic Distribution:")
for i in range(10):
    print(f"Request {i+1} -> {lb.get_server()}")
</code></pre>

          <p class="mt-3"><strong>Why this matters:</strong> In real systems preventing the "Thundering Herd" problem
            involves sophisticated load balancing. This simple class demonstrates how stronger servers can legally
            "steal" more work.</p>
        </section>

        <section class="content-section border-top pt-5">
          <h2>Summary</h2>
          <ul>
            <li>Use <strong>L4</strong> for raw performance, <strong>L7</strong> for smart routing.</li>
            <li><strong>Round Robin</strong> is great for simple stats, <strong>Least Connection</strong> for long-lived
              tasks.</li>
            <li><strong>Consistent Hashing</strong> is a must for caching layers to prevent cache avalanches.</li>
            <li>Always implement <strong>Active Health Checks</strong> to failover gracefully.</li>
          </ul>
        </section>

      </main>

      <!-- Sidebar (Left) -->
      <aside class="col-lg-3 order-lg-1 mb-4">
        <div class="sidebar-sticky">
          <h6 class="fw-bold text-uppercase text-secondary mb-3 small tracking-wide">On this page</h6>
          <nav class="nav flex-column sidebar-toc">
            <a class="nav-link" href="#what-is-lb">What is Load Balancing?</a>
            <a class="nav-link" href="#l4-vs-l7">L4 vs L7 Balancing</a>
            <a class="nav-link" href="#algorithms">Algorithms</a>
            <a class="nav-link ms-3" href="#round-robin">‚Ä¢ Round Robin</a>
            <a class="nav-link ms-3" href="#least-conn">‚Ä¢ Least Connections</a>
            <a class="nav-link ms-3" href="#consistent-hasing">‚Ä¢ Consistent Hashing</a>
            <a class="nav-link" href="#health-checks">Health Checks</a>
            <a class="nav-link" href="#ha-patterns">High Availability</a>
            <a class="nav-link" href="#implementation">Python Implementation</a>
          </nav>

          <hr class="my-4">
          <h6 class="fw-bold text-secondary mb-3 small">Related Topics</h6>
          <ul class="list-unstyled small">
            <li class="mb-2"><a href="../rate-limiting/" class="text-decoration-none text-muted">Rate Limiting</a></li>
            <li class="mb-2"><a href="../caching-layer/" class="text-decoration-none text-muted">Caching Strategies</a>
            </li>
            <li class="mb-2"><a href="../consistent-hashing/" class="text-decoration-none text-muted">Consistent
                Hashing</a></li>
          </ul>
        </div>
      </aside>

    </div>
  </div>

  <footer loadhtml="https://brijesh.work/pub/inc/footer.html"></footer>
  <script src="https://brijesh.work/pub/js/footer.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script>includeHTML();</script>
</body>

</html>