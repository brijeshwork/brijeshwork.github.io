<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JWT Authentication Guide | Step-by-Step & Security Best Practices</title>
  <meta name="description"
    content="A practical, step-by-step guide to implementing secure JWT authentication. Learn how to use HttpOnly cookies, implement Refresh Token Rotation, and prevent XSS/CSRF attacks.">
  <meta name="keywords"
    content="JWT, authentication, security, HttpOnly cookie, refresh token, CSRF, XSS, Python, Flask, tokens">
  <meta name="author" content="Brijesh Patel">
  <link rel="canonical" href="https://brijesh.work/system-design/jwt-authentication/" />

  <!-- Styles -->
  <link rel="stylesheet" href="https://brijesh.work/pub/css/bootstrap.css">
  <link rel="stylesheet" href="https://brijesh.work/pub/css/style-main.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://brijesh.work/pub/js/global.js" crossorigin="anonymous"></script>

  <style>
    /* Security Theme (Cyan/Green) */
    :root {
      --theme-primary: #06b6d4;
      /* Cyan 500 */
      --theme-secondary: #10b981;
      /* Emerald 500 */
      --theme-dark: #083344;
      /* Cyan 950 */
      --theme-light: #ecfeff;
      /* Cyan 50 */
    }

    .hero-section {
      background: linear-gradient(135deg, #022c22 0%, #083344 100%);
      color: white;
      padding: 4rem 0;
      margin-bottom: 2rem;
      border-bottom: 4px solid var(--theme-primary);
    }

    .hero-subtitle {
      color: #a5f3fc;
      font-size: 1.25rem;
    }

    .sidebar-sticky {
      position: sticky;
      top: 2rem;
    }

    .sidebar-toc .nav-link {
      color: #64748b;
      padding: 0.25rem 0;
      font-size: 0.95rem;
    }

    .sidebar-toc .nav-link:hover,
    .sidebar-toc .nav-link.active {
      color: var(--theme-primary);
      font-weight: 600;
      border-left: 2px solid var(--theme-primary);
      padding-left: 0.5rem;
    }

    .content-section {
      margin-bottom: 3.5rem;
    }

    .tech-card {
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      height: 100%;
      background: #fff;
      transition: transform 0.2s;
    }

    .tech-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border-color: var(--theme-primary);
    }

    .comparison-table th {
      background-color: var(--theme-light);
      color: var(--theme-dark);
      border-color: #cffafe;
    }

    .comparison-table td {
      vertical-align: middle;
    }

    .step-badge {
      background: var(--theme-primary);
      color: white;
      font-weight: bold;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      margin-right: 0.5rem;
      font-size: 0.9em;
    }

    .lifecycle-diagram {
      background: #f8fafc;
      border: 1px dashed #cbd5e1;
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      margin: 2rem 0;
      overflow-x: auto;
    }

    .lifecycle-step {
      display: inline-block;
      background: white;
      border: 2px solid var(--theme-primary);
      color: var(--theme-dark);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: bold;
      min-width: 140px;
      position: relative;
    }

    .lifecycle-arrow {
      display: inline-block;
      color: #94a3b8;
      margin: 0 1rem;
      font-size: 1.5rem;
      vertical-align: middle;
    }

    .alert-security {
      background-color: #f0fdf4;
      border-left: 4px solid var(--theme-secondary);
      color: #166534;
    }

    .code-header {
      background: #1e293b;
      color: #94a3b8;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      border-radius: 6px 6px 0 0;
      border-bottom: 1px solid #334155;
      font-family: monospace;
    }

    pre[class*="language-"] {
      margin-top: 0;
      border-radius: 0 0 6px 6px;
    }

    @media (max-width: 991px) {
      .order-lg-1 {
        order: 2;
      }

      .order-lg-2 {
        order: 1;
      }
    }
  </style>
</head>

<body class="bg-white">

  <header loadhtml="https://brijesh.work/pub/inc/header.html" class="header border-bottom"></header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <span class="badge bg-info bg-opacity-25 text-info border border-info border-opacity-25 mb-3">System
            Security</span>
          <h1 class="display-4 fw-bold mb-3">JWT Authentication</h1>
          <p class="hero-subtitle mb-4">A complete step-by-step guide to secure stateless authentication. Moving beyond
            LocalStorage to <strong>HttpOnly Cookies</strong> and <strong>Rotation</strong>.</p>
          <div class="d-flex gap-3">
            <a href="#implementation" class="btn btn-info fw-bold text-white">Start Implementation</a>
            <a href="#security" class="btn btn-outline-light">Security Checklist</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container pb-5">
    <div class="row">

      <!-- Main Content -->
      <main class="col-lg-9 order-lg-2">

        <!-- Concepts -->
        <section id="concepts" class="content-section">
          <h2>The Core Concept</h2>
          <p class="lead">A JWT (JSON Web Token) is like a <strong>digital passport</strong>. It allows the user to
            access routes without login in every time.</p>

          <div class="row mt-4">
            <div class="col-md-4">
              <div class="tech-card text-center">
                <span class="display-6">üîí</span>
                <h5 class="mt-2 fw-bold">Stateless</h5>
                <p class="small text-secondary">Server doesn't store sessions. All data is in the token.</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="tech-card text-center">
                <span class="display-6">‚úçÔ∏è</span>
                <h5 class="mt-2 fw-bold">Signed</h5>
                <p class="small text-secondary">Tamper-proof. If you change 1 char, the signature breaks.</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="tech-card text-center">
                <span class="display-6">üåê</span>
                <h5 class="mt-2 fw-bold">Portable</h5>
                <p class="small text-secondary">Can be used across domains and mobile apps easily.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- The Flow -->
        <section id="flow" class="content-section">
          <h2>The Secure Auth Flow</h2>
          <p>Do NOT store tokens in LocalStorage (vulnerable to XSS). Use <strong>HttpOnly Cookies</strong>.</p>

          <div class="lifecycle-diagram d-none d-md-block">
            <div class="lifecycle-step">1. Login<br><small>(POST /login)</small></div>
            <span class="lifecycle-arrow">‚Üí</span>
            <div class="lifecycle-step" style="border-color: #10b981;">2. Setup Cookie<br><small>(HttpOnly)</small>
            </div>
            <span class="lifecycle-arrow">‚Üí</span>
            <div class="lifecycle-step">3. Request<br><small>(Auto-Send)</small></div>
            <span class="lifecycle-arrow">‚Üí</span>
            <div class="lifecycle-step" style="border-color: #f59e0b;">4. Refresh<br><small>(Silent)</small></div>
          </div>
        </section>

        <!-- Implementation -->
        <section id="implementation" class="content-section">
          <h2>Step-by-Step Implementation</h2>
          <p>We will build a secure authentication flow using Python (Flask) concepts, but the logic applies to
            Node.js/Go.</p>

          <!-- Step 1 -->
          <div class="mb-5">
            <h4><span class="step-badge">Step 1</span> The Login Endpoint (Backend)</h4>
            <p>Verify credentials and issue an <strong>Access Token</strong> (short-lived) and <strong>Refresh
                Token</strong> (long-lived) in secured cookies.</p>

            <div class="code-header">backend/auth.py</div>
            <pre><code class="language-python">import jwt
import datetime
from flask import jsonify, make_response

SECRET_KEY = "super_secret_key" # Use environment variable!

def login():
    # 1. Verify username/password (omitted)
    user_id = 123
    
    # 2. Generate Access Token (15 mins)
    access_token = jwt.encode({
        'sub': user_id,
        'exp': datetime.datetime.utcnow() + datetime.timedelta(minutes=15),
        'type': 'access'
    }, SECRET_KEY, algorithm='HS256')

    # 3. Create Refesh Token (7 days) - Store hash in DB!
    refresh_token = jwt.encode({
        'sub': user_id,
        'exp': datetime.datetime.utcnow() + datetime.timedelta(days=7),
        'type': 'refresh'
    }, SECRET_KEY, algorithm='HS256')

    # 4. Set HttpOnly Cookies
    resp = make_response(jsonify({'message': 'Login successful'}))
    
    # Secure Access Token Cookie
    resp.set_cookie('access_token_cookie', access_token, 
                    httponly=True, secure=True, samesite='Strict')
                    
    # Secure Refresh Token Cookie (Path specific!)
    resp.set_cookie('refresh_token_cookie', refresh_token, 
                    httponly=True, secure=True, samesite='Strict', path='/api/refresh')
                    
    return resp</code></pre>
          </div>

          <!-- Step 2 -->
          <div class="mb-5">
            <h4><span class="step-badge">Step 2</span> Frontend Request</h4>
            <p>Since we used cookies, the browser handles storage. We just need to ensure we include credentials.</p>
            <div class="alert alert-security">
              <strong>Note:</strong> <code>httponly</code> cookies cannot be read by JavaScript. This makes them immune
              to XSS theft.
            </div>

            <div class="code-header">frontend/api.js</div>
            <pre><code class="language-javascript">// No manual token attachment needed!
async function fetchProfile() {
    try {
        const response = await fetch('/api/profile', {
            method: 'GET',
            // critical: tells browser to send cookies with request
            credentials: 'include' 
        });

        if (response.status === 401) {
            // Access token expired -> Try Refresh
            await refreshToken();
            return fetchProfile(); // Retry
        }

        const data = await response.json();
        console.log("User Data:", data);
    } catch (err) {
        console.error("Auth failed", err);
    }
}</code></pre>
          </div>

          <!-- Step 3 -->
          <div class="mb-5">
            <h4><span class="step-badge">Step 3</span> Middleware Verification</h4>
            <p>The server must read the cookie and verify the signature on every protected request.</p>

            <div class="code-header">backend/middleware.py</div>
            <pre><code class="language-python">from functools import wraps
from flask import request, abort

def token_required(f):
    @wraps(f)
    def decorated(*args, **kwargs):
        token = request.cookies.get('access_token_cookie')
        
        if not token:
            return abort(401, "Missing Token")

        try:
            data = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
            current_user_id = data['sub']
        except jwt.ExpiredSignatureError:
            return abort(401, "Token Expired")
        except jwt.InvalidTokenError:
            return abort(401, "Invalid Token")

        return f(current_user_id, *args, **kwargs)
    
    return decorated</code></pre>
          </div>

          <!-- Step 4 -->
          <div class="mb-5">
            <h4><span class="step-badge">Step 4</span> Silent Refresh (Rotation)</h4>
            <p>When the Access Token expires, the frontend calls <code>/refresh</code>. This endpoint checks the Refresh
              Token (which is also in a cookie) and issues a <strong>new pair</strong>.</p>

            <div class="code-header">backend/refresh.py</div>
            <pre><code class="language-python">@app.route('/api/refresh', methods=['POST'])
def refresh():
    # Only sent to this path thanks to cookie path restriction
    old_refresh_token = request.cookies.get('refresh_token_cookie')
    
    try:
        # Verify old token
        data = jwt.decode(old_refresh_token, SECRET_KEY, algorithms=["HS256"])
        
        # Check Reuse Detection (Database Check)
        # Verify if this refresh token was already used/revoked
        # ... logic ...
        
        # Issue NEW Access Token
        new_access_token = create_access_token(data['sub'])
        
        # ROTATION: Issue NEW Refresh Token & Revoke the old one
        new_refresh_token = create_refresh_token(data['sub'])
        
        resp = make_response(jsonify({'status': 'refreshed'}))
        resp.set_cookie('access_token_cookie', new_access_token, httponly=True)
        resp.set_cookie('refresh_token_cookie', new_refresh_token, httponly=True, path='/api/refresh')
        return resp
        
    except Exception:
        return abort(403, "Invalid Refresh Token")</code></pre>
          </div>
        </section>

        <!-- Security -->
        <section id="security" class="content-section">
          <h2>Security Best Practices</h2>
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-danger">
                <div class="card-header bg-danger text-white fw-bold">CSRF Attacks</div>
                <div class="card-body">
                  <p class="small"><strong>Risk:</strong> Since we use cookies, a malicious site can trigger requests on
                    user's behalf.</p>
                  <p class="small"><strong>Fix:</strong> Use <code>SameSite='Strict'</code> and implement a
                    Double-Submit Cookie or CSRF Token strategy for mutation requests (POST/PUT).</p>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-warning">
                <div class="card-header bg-warning text-dark fw-bold">Algorithm Confusion</div>
                <div class="card-body">
                  <p class="small"><strong>Risk:</strong> Attacker changes header alg to 'none' or 'HS256' with public
                    key.</p>
                  <p class="small"><strong>Fix:</strong> Explicitly define <code>algorithms=["HS256"]</code> in your
                    decode function. Never trust the header.</p>
                </div>
              </div>
            </div>
          </div>
        </section>

      </main>

      <!-- Sidebar -->
      <aside class="col-lg-3 order-lg-1 mb-4">
        <div class="sidebar-sticky">
          <h6 class="fw-bold text-uppercase text-secondary mb-3 small tracking-wide">On this page</h6>
          <nav class="nav flex-column sidebar-toc">
            <a class="nav-link" href="#concepts">Core Concepts</a>
            <a class="nav-link" href="#flow">Auth Flow</a>
            <a class="nav-link" href="#implementation">Implementation</a>
            <nav class="nav flex-column ms-3">
              <a class="nav-link small" href="#implementation">1. Login Endpoint</a>
              <a class="nav-link small" href="#implementation">2. Frontend Fetch</a>
              <a class="nav-link small" href="#implementation">3. Verification</a>
              <a class="nav-link small" href="#implementation">4. Silent Refresh</a>
            </nav>
            <a class="nav-link" href="#security">Security</a>
          </nav>

          <hr class="my-4">
          <h6 class="fw-bold text-secondary mb-3 small">Related Topics</h6>
          <ul class="list-unstyled small">
            <li class="mb-2"><a href="../session-vs-token/" class="text-decoration-none text-muted">Session vs Token</a>
            </li>
            <li class="mb-2"><a href="../rbac/" class="text-decoration-none text-muted">RBAC Systems</a></li>
            <li class="mb-2"><a href="../secure-api-gateway/" class="text-decoration-none text-muted">API Gateway
                Security</a></li>
          </ul>
        </div>
      </aside>

    </div>
  </div>

  <footer loadhtml="https://brijesh.work/pub/inc/footer.html"></footer>
  <script src="https://brijesh.work/pub/js/footer.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script>includeHTML();</script>
</body>

</html>