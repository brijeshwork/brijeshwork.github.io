<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>The Ultimate Guide to JWT Authentication | Step-by-Step Tutorial</title>
  <meta name="description"
    content="A comprehensive, beginner-friendly guide to JWT authentication. Learn the structure, security best practices, and how to implement it securely using HttpOnly cookies.">
  <meta name="keywords"
    content="JWT, authentication, security, HttpOnly cookie, refresh token, CSRF, XSS, Python, Flask, tokens">
  <meta name="author" content="Brijesh Patel">
  <link rel="canonical" href="https://brijesh.work/system-design/jwt-authentication/" />

  <!-- Styles -->
  <link rel="stylesheet" href="https://brijesh.work/pub/css/bootstrap.css">
  <link rel="stylesheet" href="https://brijesh.work/pub/css/style-main.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script src="https://brijesh.work/pub/js/global.js" crossorigin="anonymous"></script>

  <style>
    /* Security Theme (Cyan/Green) */
    :root {
      --theme-primary: #06b6d4;
      /* Cyan 500 */
      --theme-secondary: #10b981;
      /* Emerald 500 */
      --theme-dark: #083344;
      /* Cyan 950 */
      --theme-light: #ecfeff;
      /* Cyan 50 */
    }

    .hero-section {
      background: linear-gradient(135deg, #022c22 0%, #083344 100%);
      color: white;
      padding: 4rem 0;
      margin-bottom: 2rem;
      border-bottom: 4px solid var(--theme-primary);
    }

    .hero-subtitle {
      color: #a5f3fc;
      font-size: 1.25rem;
    }

    .sidebar-sticky {
      position: sticky;
      top: 2rem;
    }

    .sidebar-toc .nav-link {
      color: #64748b;
      padding: 0.25rem 0;
      font-size: 0.95rem;
    }

    .sidebar-toc .nav-link:hover,
    .sidebar-toc .nav-link.active {
      color: var(--theme-primary);
      font-weight: 600;
      border-left: 2px solid var(--theme-primary);
      padding-left: 0.5rem;
    }

    .content-section {
      margin-bottom: 3.5rem;
    }

    .tech-card {
      border: 1px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      height: 100%;
      background: #fff;
      transition: transform 0.2s;
    }

    .tech-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      border-color: var(--theme-primary);
    }

    .comparison-table th {
      background-color: var(--theme-light);
      color: var(--theme-dark);
      border-color: #cffafe;
    }

    .comparison-table td {
      vertical-align: middle;
    }

    .step-badge {
      background: var(--theme-primary);
      color: white;
      font-weight: bold;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      margin-right: 0.5rem;
      font-size: 0.9em;
    }

    .lifecycle-diagram {
      background: #f8fafc;
      border: 1px dashed #cbd5e1;
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      margin: 2rem 0;
      overflow-x: auto;
    }

    .lifecycle-step {
      display: inline-block;
      background: white;
      border: 2px solid var(--theme-primary);
      color: var(--theme-dark);
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: bold;
      min-width: 140px;
      position: relative;
    }

    .lifecycle-arrow {
      display: inline-block;
      color: #94a3b8;
      margin: 0 1rem;
      font-size: 1.5rem;
      vertical-align: middle;
    }

    .alert-security {
      background-color: #f0fdf4;
      border-left: 4px solid var(--theme-secondary);
      color: #166534;
    }

    .code-header {
      background: #1e293b;
      color: #94a3b8;
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      border-radius: 6px 6px 0 0;
      border-bottom: 1px solid #334155;
      font-family: monospace;
    }

    pre[class*="language-"] {
      margin-top: 0;
      border-radius: 0 0 6px 6px;
    }

    @media (max-width: 991px) {
      .order-lg-1 {
        order: 2;
      }

      .order-lg-2 {
        order: 1;
      }
    }
  </style>
</head>

<body class="bg-white">

  <header loadhtml="https://brijesh.work/pub/inc/header.html" class="header border-bottom"></header>

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <span class="badge bg-info bg-opacity-25 text-info border border-info border-opacity-25 mb-3">System
            Security</span>
          <h1 class="display-4 fw-bold mb-3">The Ultimate Guide to JWT Authentication</h1>
          <p class="hero-subtitle mb-4">Stop wrestling with session state. Learn how to implement secure, stateless
            authentication using JSON Web Tokens (JWT) in minutes.</p>
          <div class="d-flex gap-3">
            <a href="#implementation" class="btn btn-info fw-bold text-white">Jump to Code</a>
            <a href="#pitfalls" class="btn btn-outline-light">Common Pitfalls</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container pb-5">
    <div class="row">

      <!-- Main Content -->
      <main class="col-lg-9 order-lg-2">

        <!-- 1. Introduction -->
        <section id="introduction" class="content-section">
          <h2>Introduction</h2>
          <p class="lead">Imagine you're at a massive music festival. Every time you want to enter a VIP area, you have
            two choices:</p>
          <ul class="list-unstyled ms-3">
            <li class="mb-2"><strong>Option A:</strong> The guard calls the main office to check if your name is on the
              list. (Slow, relies on the office phone).</li>
            <li class="mb-2"><strong>Option B:</strong> You show a holographic wristband that the guard can verify
              instantly with a scanner. (Fast, efficient).</li>
          </ul>
          <p><strong>Option A is Session Authentication.</strong> The server (office) has to look you up every time.<br>
            <strong>Option B is JWT Authentication.</strong> You carry your credentials with you, signed and verified
            instantly.
          </p>

          <p>In this guide, we'll break down exactly how JWTs work, why they are the standard for modern APIs, and—most
            importantly—how to implement them <em>securely</em>.</p>
        </section>

        <!-- 2. What is JWT? -->
        <section id="basics" class="content-section">
          <h2>What is JWT Authentication?</h2>
          <p><strong>JSON Web Token (JWT)</strong> is an open standard that defines a compact, self-contained way for
            securely transmitting information between parties as a JSON object.</p>

          <div class="card bg-light border-0 p-3 mb-4">
            <h5 class="fw-bold">The Problem It Solves: Statelessness</h5>
            <p class="mb-0">In traditional apps, the server keeps a record (Session ID) of every logged-in user. As you
              scale to millions of users, that's millions of lookups. With JWT, the <strong>server generates a
                token</strong> that the client holds. The server doesn't need to remember anything—it just verifies the
              signature.</p>
          </div>

          <h5 class="fw-bold">When to use JWT?</h5>
          <ul>
            <li><strong>Microservices:</strong> Services can verify tokens independently without calling a central auth
              server.</li>
            <li><strong>Mobile Apps:</strong> Easier to handle tokens than cookies in native iOS/Android apps.</li>
            <li><strong>Single Sign-On (SSO):</strong> One token can grant access to multiple domains.</li>
          </ul>
        </section>

        <!-- 3. How JWT Works (Technical Flow) -->
        <section id="flow" class="content-section">
          <h2>How JWT Works: The Flow</h2>
          <p>Here is the lifecycle of a secure authentication request:</p>

          <div class="lifecycle-diagram d-none d-md-block">
            <div class="lifecycle-step">1. User Login<br><small>(Creds)</small></div>
            <span class="lifecycle-arrow">→</span>
            <div class="lifecycle-step" style="border-color: #10b981;">2. Server Signs<br><small>(Generates JWT)</small>
            </div>
            <span class="lifecycle-arrow">→</span>
            <div class="lifecycle-step">3. Client Stores<br><small>(HttpOnly Cookie)</small></div>
            <span class="lifecycle-arrow">→</span>
            <div class="lifecycle-step" style="border-color: #f59e0b;">4. Verify<br><small>(Signature Check)</small>
            </div>
          </div>

          <ol>
            <li><strong>Login:</strong> User sends username/password to the server.</li>
            <li><strong>Verification & Signing:</strong> Server checks creds. If valid, it creates a JSON payload (user
              ID, role) and <strong>signs</strong> it with a secret key.</li>
            <li><strong>Response:</strong> Server sends the JWT back (preferably in a secure cookie).</li>
            <li><strong>Subsequent Requests:</strong> Client sends the JWT automatically with every request.</li>
            <li><strong>Access:</strong> Server verifies the signature. If valid, access is granted.</li>
          </ol>
        </section>

        <!-- 4. JWT Structure -->
        <section id="structure" class="content-section">
          <h2>Anatomy of a JWT</h2>
          <p>A JWT is just a string with three parts separated by dots (<code>.</code>):
            <strong>Header.Payload.Signature</strong></p>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="tech-card">
                <strong class="text-primary">1. Header</strong>
                <p class="small text-muted mb-0">Algorithm & Type</p>
                <code class="d-block mt-2 small">{"alg": "HS256", "typ": "JWT"}</code>
              </div>
            </div>
            <div class="col-md-4">
              <div class="tech-card">
                <strong class="text-primary">2. Payload</strong>
                <p class="small text-muted mb-0">Data (Claims)</p>
                <code class="d-block mt-2 small">{"sub": "123", "name": "Brijesh"}</code>
              </div>
            </div>
            <div class="col-md-4">
              <div class="tech-card">
                <strong class="text-primary">3. Signature</strong>
                <p class="small text-muted mb-0">Validation</p>
                <code class="d-block mt-2 small">HMACSHA256(base64(h) + "." + base64(p), secret)</code>
              </div>
            </div>
          </div>

          <div class="alert alert-warning mt-4">
            <strong>⚠️ Vital Distinction: Encoding vs. Encryption</strong>
            <p class="mb-0">JWTs are <strong>Base64 Encoded</strong>, NOT encrypted. This means <strong>anyone can read
                the payload</strong> if they have the token. Do not put secrets (passwords, SSNs) in the payload!</p>
          </div>
        </section>

        <!-- 5. Implementation -->
        <section id="implementation" class="content-section">
          <h2>Implementing JWT: Practical Guide</h2>
          <p>Let's build a production-ready auth system using <strong>Python (Flask)</strong>. The concepts apply
            equally to Node.js or Go.</p>

          <!-- Backend -->
          <h4 class="mt-4"><span class="step-badge">Backend</span> Setting up the Endpoint</h4>
          <p>We need to generate two tokens: a short-lived <strong>Access Token</strong> (15 min) and a long-lived
            <strong>Refresh Token</strong> (7 days).</p>

          <div class="code-header">backend/auth.py</div>
          <pre><code class="language-python">import jwt
import datetime
from flask import jsonify, make_response

SECRET_KEY = "your_super_secret_key" # Keep this safe!

def login():
    # 1. Verify User (Mock logic)
    user_id = 123
    
    # 2. Generate Access Token (15 mins)
    access_token = jwt.encode({
        'sub': user_id,
        'exp': datetime.datetime.utcnow() + datetime.timedelta(minutes=15),
        'type': 'access'
    }, SECRET_KEY, algorithm='HS256')

    # 3. Secure Delivery - HttpOnly Cookie
    # We do NOT send the token in the JSON body to avoid LocalStorage
    resp = make_response(jsonify({'message': 'Login successful'}))
    
    resp.set_cookie('access_token', access_token, 
                    httponly=True,  # No JS access (Prevents XSS)
                    secure=True,    # HTTPS only
                    samesite='Strict') # CSRF Protection
                    
    return resp</code></pre>

          <!-- Frontend -->
          <h4 class="mt-5"><span class="step-badge">Frontend</span> Sending the Token</h4>
          <p>Since we used cookies, you don't need to manually attach headers! Identifying yourself is as simple as
            setting <code>credentials: 'include'</code>.</p>

          <div class="code-header">frontend/api.js</div>
          <pre><code class="language-javascript">async function getDashboard() {
    const response = await fetch('/api/dashboard', {
        method: 'GET',
        credentials: 'include' // Browser auto-sends the cookie
    });

    if (response.status === 401) {
        // Token expired? Call refresh endpoint
        await refreshAccessToken();
        return getDashboard(); // Retry
    }
}</code></pre>

          <!-- Middleware -->
          <h4 class="mt-5"><span class="step-badge">Backend</span> Verifying the Token</h4>
          <div class="code-header">backend/middleware.py</div>
          <pre><code class="language-python">from flask import request, abort

def protect_route(f):
    def wrapper(*args, **kwargs):
        token = request.cookies.get('access_token')
        
        if not token:
            return abort(401, "Please log in")

        try:
            # Verify signature
            data = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
        except jwt.ExpiredSignatureError:
            return abort(401, "Token expired")
        except jwt.InvalidTokenError:
            return abort(401, "Invalid token")

        return f(*args, **kwargs)
    return wrapper</code></pre>
        </section>

        <!-- 6. Security Best Practices -->
        <section id="security" class="content-section">
          <h2>Security Best Practices</h2>
          <ul>
            <li><strong>HTTPS is Mandatory:</strong> Without HTTPS, anyone on the network can steal your token and
              impersonate the user.</li>
            <li><strong>Short Lifetimes:</strong> Keep access tokens short (5-15 mins). Creates a smaller window for
              damage if stolen.</li>
            <li><strong>Rotation:</strong> When using Refresh Tokens, change the refresh token every time it is used.
              This allows you to detect theft (if an old refresh token is used, you know something is wrong).</li>
          </ul>
        </section>

        <!-- 7. Common Pitfalls -->
        <section id="pitfalls" class="content-section">
          <h2>Common Pitfalls & Solutions</h2>
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-danger">
                <div class="card-header bg-danger text-white">Mistake #1: Storing in LocalStorage</div>
                <div class="card-body">
                  <p class="card-text"><strong>Why:</strong> Any script on your page (ads, analytics, npm packages) can
                    read LocalStorage.</p>
                  <p class="card-text"><strong>Fix:</strong> Use <code>HttpOnly</code> cookies.</p>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-warning">
                <div class="card-header bg-warning text-dark">Mistake #2: Huge Payloads</div>
                <div class="card-body">
                  <p class="card-text"><strong>Why:</strong> The JWT is sent with <em>every request</em>. A fat token
                    slows down your app.</p>
                  <p class="card-text"><strong>Fix:</strong> Only put the user ID and role in the token. Fetch the rest
                    from DB.</p>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-info">
                <div class="card-header bg-info text-white">Mistake #3: Accept 'None' Algo</div>
                <div class="card-body">
                  <p class="card-text"><strong>Why:</strong> Attackers can bypass signature check by setting
                    <code>alg: none</code>.</p>
                  <p class="card-text"><strong>Fix:</strong> Explicitly set <code>algorithms=["HS256"]</code> in your
                    decode function.</p>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="card h-100 border-success">
                <div class="card-header bg-success text-white">Mistake #4: No Refresh Strategy</div>
                <div class="card-body">
                  <p class="card-text"><strong>Why:</strong> If the token never expires, you can't ban a user.</p>
                  <p class="card-text"><strong>Fix:</strong> Use short expiry + Refresh Tokens.</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- 8. Conclusion -->
        <section class="content-section border-top pt-5">
          <h2>Conclusion</h2>
          <p>JWTs are a powerful tool for modern authentication, but they come with responsibility. By moving away from
            LocalStorage and implementing robust verification logic, you can build a system that is both secure and
            scalable.</p>
          <p><strong>Ready to start?</strong> Grab the code examples above and try implementing a basic login flow in
            your favorite framework today!</p>
        </section>

      </main>

      <!-- Sidebar -->
      <aside class="col-lg-3 order-lg-1 mb-4">
        <div class="sidebar-sticky">
          <h6 class="fw-bold text-uppercase text-secondary mb-3 small tracking-wide">On this page</h6>
          <nav class="nav flex-column sidebar-toc">
            <a class="nav-link" href="#introduction">1. Introduction</a>
            <a class="nav-link" href="#basics">2. What is JWT?</a>
            <a class="nav-link" href="#flow">3. Technical Flow</a>
            <a class="nav-link" href="#structure">4. JWT Structure</a>
            <a class="nav-link" href="#implementation">5. Implementation Guide</a>
            <a class="nav-link" href="#security">6. Security Best Practices</a>
            <a class="nav-link" href="#pitfalls">7. Common Pitfalls</a>
          </nav>

          <hr class="my-4">
          <h6 class="fw-bold text-secondary mb-3 small">Related Topics</h6>
          <ul class="list-unstyled small">
            <li class="mb-2"><a href="../session-vs-token/" class="text-decoration-none text-muted">Session vs Token</a>
            </li>
            <li class="mb-2"><a href="../rbac/" class="text-decoration-none text-muted">RBAC Systems</a></li>
            <li class="mb-2"><a href="../secure-api-gateway/" class="text-decoration-none text-muted">API Gateway</a>
            </li>
          </ul>
        </div>
      </aside>

    </div>
  </div>

  <footer loadhtml="https://brijesh.work/pub/inc/footer.html"></footer>
  <script src="https://brijesh.work/pub/js/footer.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script>includeHTML();</script>
</body>

</html>